# 文档分片功能更新日志

## 2025-01-02

### 新增功能：智能文档分片

#### 概述
为 xtool MCP Server 添加了自动文档分片功能，解决了当 AI 生成超长响应时可能遇到的显示和传输问题。

#### 主要特性
- **自动触发**：当任何工具的输出超过 30,000 tokens 时自动分片
- **智能分割**：在自然边界（章节、段落）处分割，保持内容完整性
- **代码块保护**：确保代码块不会在中间被分割
- **用户友好**：清晰的分片标记和继续提示

#### 技术实现
1. **新增组件**：
   - `utils/document_chunker.py` - 核心分片算法
   - `tools/shared/document_chunk_mixin.py` - 可复用的分片功能混入类

2. **修改的文件**：
   - `tools/simple/base.py` - 集成分片功能到所有简单工具
   - `tools/__init__.py` - 确保正确导出

3. **文档更新**：
   - `docs/DOCUMENT_CHUNKING_GUIDE.md` - 详细使用指南
   - `docs/USER_GUIDE.md` - 添加分片功能说明

#### 使用示例
```bash
# 请求生成长文档
claude --mode zen-mcp chat "请生成一份详细的系统架构文档"

# 系统会自动分片并提供继续选项
```

#### 注意事项
- Token 估算使用 1 token ≈ 4 字符的比例
- 实际需要约 120,000 字符才能触发分片
- 超大代码块仍可能被分割（建议拆分为多个较小的块）

#### 后续优化方向
- 支持自定义分片阈值
- 改进 token 估算精度
- 添加分片预览功能
- 支持跳转到特定分片